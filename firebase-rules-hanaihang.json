{
  "rules_version": "2",
  "rules": {
    "malls": {
      ".read": "true",
      ".write": "auth != null",
      ".validate": "newData.hasChildren(['name', 'location', 'stores'])",
      "$mallId": {
        "name": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "location": {
          ".validate": "newData.hasChildren(['lat', 'lng', 'address'])",
          "lat": {
            ".validate": "newData.isNumber() && newData.val() >= -90 && newData.val() <= 90"
          },
          "lng": {
            ".validate": "newData.isNumber() && newData.val() >= -180 && newData.val() <= 180"
          },
          "address": {
            ".validate": "newData.isString() && newData.val().length > 0"
          }
        },
        "stores": {
          ".validate": "newData.hasChildren()",
          "$storeId": {
            ".validate": "newData.hasChildren(['name', 'category', 'floor', 'unit'])",
            "name": {
              ".validate": "newData.isString() && newData.val().length > 0"
            },
            "category": {
              ".validate": "newData.isString() && newData.val().length > 0"
            },
            "floor": {
              ".validate": "newData.isNumber() && newData.val() >= 1"
            },
            "unit": {
              ".validate": "newData.isString() && newData.val().length > 0"
            },
            "operatingHours": {
              ".validate": "newData.isString()"
            },
            "contact": {
              ".validate": "newData.isString()"
            }
          }
        },
        "operatingHours": {
          ".validate": "newData.isString()"
        },
        "contact": {
          ".validate": "newData.isString()"
        }
      }
    },
    
    "stores": {
      ".read": "true",
      ".write": "auth != null",
      ".validate": "newData.hasChildren(['name', 'category', 'mallId'])",
      "$storeId": {
        "name": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "category": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "mallId": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "floor": {
          ".validate": "newData.isNumber() && newData.val() >= 1"
        },
        "unit": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "operatingHours": {
          ".validate": "newData.isString()"
        },
        "contact": {
          ".validate": "newData.isString()"
        }
      }
    },
    
    "users": {
      ".read": "auth != null",
      ".write": "auth != null",
      "$userId": {
        ".validate": "auth.uid == $userId",
        "email": {
          ".validate": "newData.isString() && newData.val().matches(/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$/)"
        },
        "role": {
          ".validate": "newData.isString() && (newData.val() == 'admin' || newData.val() == 'user')"
        },
        "lastLogin": {
          ".validate": "newData.isNumber()"
        }
      }
    },
    
    "searchLogs": {
      ".read": "auth != null",
      ".write": "true",
      ".validate": "newData.hasChildren(['query', 'timestamp', 'location'])",
      "$logId": {
        "query": {
          ".validate": "newData.isString() && newData.val().length > 0"
        },
        "timestamp": {
          ".validate": "newData.isNumber()"
        },
        "location": {
          ".validate": "newData.hasChildren(['lat', 'lng'])",
          "lat": {
            ".validate": "newData.isNumber() && newData.val() >= -90 && newData.val() <= 90"
          },
          "lng": {
            ".validate": "newData.isNumber() && newData.val() >= -180 && newData.val() <= 180"
          }
        },
        "results": {
          ".validate": "newData.isNumber() && newData.val() >= 0"
        }
      }
    },
    
    "appSettings": {
      ".read": "true",
      ".write": "auth != null",
      "version": {
        ".validate": "newData.isString()"
      },
      "maintenance": {
        ".validate": "newData.isBoolean()"
      },
      "features": {
        ".validate": "newData.hasChildren()"
      }
    }
  }
}
